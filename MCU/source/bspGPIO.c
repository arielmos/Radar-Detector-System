#include <msp430.h>
#include  "bspGPIO.h"   
#include  "halTIMERS.h"

void InitGPIO(void){
//------------------------------------------------------------------------------------------------------------------
// Initial Watch Dog timer
//------------------------------------------------------------------------------------------------------------------
    WDTCTL = WDTHOLD | WDTPW;        				 // Stop WDT
	
//------------------------------------------------------------------------------------------------------------------
// DCO Configuration for Flash Writing - Digital Controlled Oscillator
//------------------------------------------------------------------------------------------------------------------
	if (CALBC1_1MHZ==0xFF)					 		 // If calibration constant erased
	  {											
		while(1);                            		 // Do not load, trap CPU!!	
	  }
	DCOCTL = 0;                             		 // Select lowest DCOx and MODx settings
	BCSCTL1 = CALBC1_1MHZ;                  		 // Set DCO
	DCOCTL = CALDCO_1MHZ;

	FCTL2 = FWKEY + FSSEL0 + FN1;          		     // MCLK/3 for Flash Timing Generator
	
//------------------------------------------------------------------------------------------------------------------
// Port 1 Configuration: Led 0 - 1.0, UART - 1.1-2, Led 1-3 - 1.3-5, SS-Trig - 1.6, Led 4 - 1.7
//------------------------------------------------------------------------------------------------------------------
    P1SEL = 0x40;     		 // Led 0 - 1.0, Led 1-3 - 1.3-5, Led 4 - 1.7 as GPIO and SS-Trig - 1.6 as TA0.1(0x40)(01000000)
    P1DIR = 0xF9;     		 // Led 0 - 1.0, Led 1-3 - 1.3-5, Led 4 - 1.7, SS-Trig - 1.6 as GPIO-output (0xF9)(11111001)
    P1IFG = 0x00;  	     // Clear all interrupts pending  

//---------------------------------------------------------------------------------------------------------------------
// Port 2 Configuration: Led 5 - 2.0, SS-Echo - 2.1,Blue - 2.2, Green - 2.3, Red - 2.4, PWM Servo - 2.5, Leds 6-7 - 2.6-7 
//---------------------------------------------------------------------------------------------------------------------
	P2SEL = 0x22;					 // Led 5 - 2.0, Blue - 2.2, Green - 2.3, Red - 2.4, Leds 6-7 - 2.6-7 as GPIO and SS-Echo - 2.1 as TA1.1, PWM Servo - 2.5 as TA1.2 - CCI0A (0x22)(00100010)
	P2DIR = 0xFD;          			 // SS-Echo - 2.1 as GPIO-input and Led 5 - 2.0, Blue - 2.2, Green - 2.3, Red - 2.4, PWM Servo - 2.5, Leds 6-7 - 2.6-7 as GPIO-output (0xFD)(11111101)
	
//----------------------------------------------------------------------------------------------------
// Clear RGB and Leds
//----------------------------------------------------------------------------------------------------
	RGB_CLR											 // Clear RGB
	Leds_CLR			                    		 // Clear Leds
	
//----------------------------------------------------------------------------------------------------
// Rotate Servo to 90 degree
//----------------------------------------------------------------------------------------------------
	PWM_Servo_config(90);
    Timer0_A_delay_ms(50);
    StopTimers();
//----------------------------------------------------------------------------------------------------
// UART Configuration
//----------------------------------------------------------------------------------------------------  
	P1SEL |= BIT1 + BIT2 ;    // P1.1 = RXD, P1.2=TXD
	P1SEL2 = BIT1 + BIT2 ;    // P1.1 = RXD, P1.2=TXD
	P1OUT = 0;                // All P1.x reset
    uart_config();   
}
